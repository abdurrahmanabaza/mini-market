<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>السوق الإلكتروني</title>
<!-- خط عربي -->
<link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet" />
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  body {
    font-family: 'Cairo', Arial, Tahoma, sans-serif;
    background-color: #f8f9fa;
    color: #333;
    line-height: 1.6;
    margin-top: 60px;
    position: relative;
  }
  header {
    position: fixed; 
    width: 100%;
    background-color: #007bff;
    color: #fff;
    padding: 10px 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 14px;
    top: 0;
    z-index: 999;
  }
  header h1 {
    font-size: 1.2em;
  }
  #searchInput {
    display: flex;
    position: fixed; 
    top: 52px;
    left: 30px;
    margin-bottom: 15px;
    width: 90%;
    max-width: 300px;
    padding: 13px 17px;
    font-size: 16px;
    border-radius: 25px;
    border: 2px solid #007bff;
    outline: none;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }
  #searchInput:focus {
    border-color: #0056b3;
    box-shadow: 0 6px 12px rgba(0,0,0,0.2);
  }
  .products {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    margin-top: 100px;
  }
  .product {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 300px;
    padding: 15px;
    transition: transform 0.2s;
    text-align: center;
  }
  .product:hover {
    transform: scale(1.02);
  }
  .product h3 {
    margin-bottom: 10px;
    font-size: 1.2em;
  }
  .price {
    color: #e60000;
    font-weight: bold;
    margin-bottom: 10px;
  }
  .quantity-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 10px;
  }
  .quantity-controls button {
    padding: 5px 10px;
    font-size: 1em;
    border: none;
    background-color: #007bff;
    color: #fff;
    border-radius: 4px;
    cursor: pointer;
    margin: 0 5px;
    transition: background-color 0.3s;
  }
  .quantity-controls button:hover {
    background-color: #0056b3;
  }
  #qtyInput {
    width: 40px;
    height: 30px;
    text-align: center;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin: 0 5px;
    font-size: 1em;
  }
  /* زر عائم للسلة */
  #cartFloatingButton {
    position: fixed;
    bottom: 22px;
    left: 15px;
    background-color: #0f7b5a;
    color: #fff;
    padding: 12px 20px;
    border-radius: 50px;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    font-size: 16px;
    display: flex;
    align-items: center;
    transition: background-color 0.3s;
  }
  #cartFloatingButton:hover {
    background-color: #388E3C;
  }
  /* لوحة إدارة المنتجات - مخفية الآن */
  #adminPanel {
    display: none;
    position: fixed; 
    top: 50px; 
    right: 50px; 
    background: #fff; 
    padding: 20px; 
    border-radius: 8px; 
    max-height: 80%; 
    overflow: auto; 
    z-index: 9999; 
    width: 90%; 
    max-width: 900px;
  }
  /* أزرار +/- للكمية */
  .quantity-controls button {
    padding: 5px 10px;
    font-size: 1em;
    border: none;
    background-color: #007bff;
    color: #fff;
    border-radius: 4px;
    cursor: pointer;
    margin: 0 5px;
    transition: background-color 0.3s;
  }
  .quantity-controls button:hover {
    background-color: #0056b3;
  }
  /* صفحة السلة */
  #cartPage {
    display: none;
    padding: 20px;
  }
  #cartPage.active {
    display: block;
  }
  #orderForm {
    display: none;
    margin-top: 20px;
  }
  #orderForm.active {
    display: block;
  }
  footer {
    background-color: #343a40;
    color: #fff;
    padding: 20px;
    text-align: center;
    margin-top: 40px;
  }
  /* محتوى إضافي */
  #mainContent {
    padding: 10px;
  }
</style>
</head>
<body>

<header>
  <h1>السوق الإلكتروني</h1>
</header>

<!-- زر المدير - تم إزالته في حال رغبتك -->
<!--
<button id="adminFixedBtn" onclick="promptAdmin()" style="display:none;">وضع المدير</button>
-->

<!-- زر السلة -->
<button id="cartFloatingButton" onclick="showCartPage()">
  🛒 السلة <span id="cartCount">0</span>
</button>

<!-- البحث -->
<div id="mainContent">
  <h2 style="text-align:center; margin-bottom:14px; margin-top:8px;">منتجاتنا</h2>
  <input type="text" id="searchInput" placeholder="🔍 ابحث عن منتج..." />
  <div class="products" id="productsContainer"></div>
</div>

<!-- صفحة السلة -->
<div id="cartPage">
  <h2 style="text-align:center;">السلة</h2>
  <ul id="cartItems"></ul>
  <div id="totalPrice" style="text-align:right; font-weight:bold; margin-top:15px;">المجموع النهائي: 0 ل.س</div>
  <button onclick="showMain()" style="margin-top:15px; padding:10px 20px; background-color:#007bff; color:#fff; border:none; border-radius:4px; cursor:pointer;">العودة للمنتجات</button>
  <button id="confirmOrderBtn" style="margin-top:15px; padding:10px 20px; background-color:#28a745; color:#fff; border:none; border-radius:4px; cursor:pointer;">تأكيد الطلب</button>
</div>

<!-- حقل التوصيل -->
<div id="orderForm" style="margin-top:20px;">
  <h3>املأ بيانات التوصيل</h3>
  <label>العنوان:</label>
  <input type="text" id="deliveryAddress" placeholder="أدخل عنوانك" style="width:100%; margin-bottom:10px; padding:8px;"/>
  <label>رقم الهاتف:</label>
  <input type="text" id="phoneNumber" placeholder="أدخل رقم هاتفك" style="width:100%; margin-bottom:10px; padding:8px;"/>
</div>

<!-- حقوق النشر -->
<footer>
  <p>© 2025 السوق الإلكتروني. جميع الحقوق محفوظة.</p>
</footer>

<script>
  // إعدادات Firebase
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    databaseURL: "YOUR_DATABASE_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // المنتجات
  let items = [];
  let filteredItems = [];

  // سلة
  let cart = [];

  // تحميل المنتجات من Firebase
  function loadProducts() {
    const container = document.getElementById('productsContainer');
    container.innerHTML = 'جاري التحميل...';

    db.ref('products').once('value')
      .then(snapshot => {
        items = [];
        const data = snapshot.val();
        if (data) {
          for (const key in data) {
            if (data.hasOwnProperty(key)) {
              items.push({ 
                id: key, 
                name: data[key].name, 
                image: data[key].image, 
                value: data[key].value, 
                quantity: data[key].quantity 
              });
            }
          }
        }
        filteredItems = [...items];
        renderProducts();
        container.innerHTML = '';
      })
      .catch(error => {
        container.innerHTML = 'فشل في تحميل البيانات.';
        console.error(error);
      });
  }

  // عرض المنتجات
  function renderProducts() {
    const container = document.getElementById('productsContainer');
    container.innerHTML = '';
    filteredItems.forEach((item, index) => {
      const div = document.createElement('div');
      div.className='product';
      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}" style="width:auto; height:98px; border-radius:8px; margin-bottom:15px; margin: 0 auto; display: block;">
        <h3>${item.name}</h3>
        <p class="price">السعر: ${item.value} ل.س</p>
        <div class="quantity-controls">
          <button onclick="decreaseQty(${index})">-</button>
          <input type="text" id="qtyInput${index}" value="1" readonly />
          <button onclick="increaseQty(${index}, ${item.quantity})">+</button>
        </div>
        <a href="#" class="btn" onclick="addToCart(event, ${index})">إضافة إلى السلة</a>
      `;
      container.appendChild(div);
    });
  }

  // البحث
  document.getElementById('searchInput').addEventListener('input', () => {
    const q = document.getElementById('searchInput').value.trim().toLowerCase();
    if (q === "") {
      filteredItems = [...items];
    } else {
      filteredItems = items.filter(i => i.name.toLowerCase().includes(q));
    }
    renderProducts();
  });

  // زيادة الكمية
  function increaseQty(index, max) {
    const input = document.getElementById(`qtyInput${index}`);
    let val = parseInt(input.value);
    if (val < max) {
      input.value = val + 1;
    } else {
      alert('لا يمكن شراء أكثر من الكمية المتوفرة');
    }
  }

  // تقليل الكمية
  function decreaseQty(index) {
    const input = document.getElementById(`qtyInput${index}`);
    let val = parseInt(input.value);
    if (val > 1) {
      input.value = val - 1;
    }
  }

  // إضافة المنتج إلى السلة
  function addToCart(e, index) {
    e.preventDefault();
    const qty = parseInt(document.getElementById(`qtyInput${index}`).value);
    const item = items[index];
    const existingIndex = cart.findIndex(c => c.index === index);
    if (existingIndex !== -1) {
      if (cart[existingIndex].quantity + qty <= item.quantity) {
        cart[existingIndex].quantity += qty;
      } else {
        alert('الكمية الإجمالية تتجاوز الكمية المتوفرة');
        return;
      }
    } else {
      cart.push({ index, name: item.name, value: item.value, quantity: qty, max: item.quantity });
    }
    updateCartCount();
    alert('تمت إضافة المنتج إلى السلة');
  }

  // تحديث عداد السلة
  function updateCartCount() {
    const totalItems = cart.reduce((sum, c) => sum + c.quantity, 0);
    document.getElementById('cartCount').innerText = totalItems;
  }

  // عرض صفحة السلة
  function showCartPage() {
    document.getElementById('mainContent').style.display='none';
    document.getElementById('cartPage').style.display='block';
    renderCart();
    document.getElementById('orderForm').classList.remove('active');
  }

  // عرض الصفحة الرئيسية
  function showMain() {
    document.getElementById('mainContent').style.display='block';
    document.getElementById('cartPage').style.display='none';
    document.getElementById('orderForm').classList.remove('active');
  }

  // عرض السلة
  function renderCart() {
    const container = document.getElementById('cartItems');
    container.innerHTML = '';
    let total = 0;
    cart.forEach((item, index) => {
      total += item.value * item.quantity;
      const li = document.createElement('li');
      li.innerHTML = `
        <strong>${item.name}</strong><br/>
        السعر: ${item.value.toLocaleString()} ل.س<br/>
        الكمية: ${item.quantity} <br/>
        <button onclick="removeFromCart(${index})" style="margin-top:5px; padding:5px 10px; background-color:#e60000; color:#fff; border:none; border-radius:4px; cursor:pointer;">حذف</button>
      `;
      container.appendChild(li);
    });
    document.getElementById('totalPrice').innerText = `المجموع النهائي: ${total.toLocaleString()} ل.س`;
  }

  // حذف عنصر من السلة
  function removeFromCart(i) {
    cart.splice(i,1);
    renderCart();
    updateCartCount();
  }

  // تأكيد الطلب
  document.getElementById('confirmOrderBtn').addEventListener('click', () => {
    if (cart.length === 0) {
      alert('السلة فارغة');
      return;
    }
    document.getElementById('orderForm').classList.add('active');
    document.getElementById('cartPage').style.display='none';
  });

  // إرسال الطلب عبر واتساب
document.querySelector('#confirmOrderBtn').addEventListener('click', () => {
  const address = document.getElementById('deliveryAddress').value.trim();
  const phone = document.getElementById('phoneNumber').value.trim();
  if (!address || !phone) {
      alert('يرجى ملء العنوان ورقم الهاتف');
      return;
  }
  let message = 'طلب جديد:\n';
  let total = 0;
  cart.forEach(item => {
      total += item.value * item.quantity;
      message += `${item.name} × ${item.quantity}\n`;
  });
  message += `ـــــــــــــــــــــــــــــــــــــ\n`;
  message += `المجموع النهائي: ${total.toLocaleString()} ل.س\n`;
  message += `\nالعنوان: ${address}\n`;
  message += `رقم الهاتف: ${phone}\n`;
  const encodedMessage = encodeURIComponent(message);
  const whatsappNumber = '+963936421060';
  const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
  window.open(whatsappURL, '_blank');
  document.getElementById('deliveryAddress').value = '';
  document.getElementById('phoneNumber').value = '';
  document.getElementById('orderForm').classList.remove('active');
  showMain();
});

// تحميل المنتجات عند فتح الصفحة
window.onload = () => {
  loadProducts();
};
</script>
</body>
</html>
