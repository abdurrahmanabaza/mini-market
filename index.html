<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
<!-- Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ù…Ù† Google Fonts ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© -->
<link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet" />
<link rel="icon" href="images/icon.jpg">
<!-- Ø£Ù† ØªØ¶Ø¹ Ù‡Ù†Ø§ ÙƒÙˆØ¯ Ø§Ù„Ù€ module Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -->
</head>
<body>
<header>
    <h1>Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h1>
</header>

<!-- Ø²Ø± Ø§Ù„Ø³Ù„Ø© Ø¹Ø§Ø¦Ù… -->
<button id="cartFloatingButton" onclick="showCartPage()">
    ğŸ›’ Ø§Ù„Ø³Ù„Ø© <span id="cartCount">0</span>
</button>

<!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
<div id="mainContent" class="container">
    <h2 style="text-align:center; margin-bottom: 14px; margin-top: 8px;">Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§</h2>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." />
    </div>
    <div class="products" id="productsContainer"></div>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø© -->
<div id="cartPage" style="display:none;">
    <h2 style="text-align:center;">Ø§Ù„Ø³Ù„Ø©</h2>
    <ul id="cartItems"></ul>
    <div id="totalPrice">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: 0 Ù„.Ø³</div>
    <button onclick="showMain()" style="margin-top:15px; padding:10px 20px; background-color:#007bff; color:#fff; border:none; border-radius:4px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
    <button id="confirmOrderBtn" style="margin-top:15px; padding:10px 20px; background-color:#28a745; color:#fff; border:none; border-radius:4px;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<!-- Ø­Ù‚Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„ -->
<div id="orderForm" style="display:none; margin-top:20px;">
    <h3>Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
    <input type="text" id="deliveryAddress" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù†Ùƒ" />
    <br/><br/>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
    <input type="text" id="phoneNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ" />
</div>

<!-- Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± -->
<footer>
    <p>Â© 2025 Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
</footer>

<!-- Ø³ÙƒØ±Ø¨ØªØ§Øª Firebase Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ES modules -->
<script type="module">
  // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…Ù† Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDqUZQR3O5Ux3nyWsbgdnlQxcAU7qKXrKU",
    authDomain: "local-products-82f7d.firebaseapp.com",
    databaseURL: "https://local-products-82f7d-default-rtdb.firebaseio.com",
    projectId: "local-products-82f7d",
    storageBucket: "local-products-82f7d.firebasestorage.app",
    messagingSenderId: "92892216531",
    appId: "1:92892216531:web:b39013834c0215eaf2e826"
  };

  // ØªÙ‡ÙŠØ¦Ø© Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø¹ Ù…Ø¹Ø±ÙØ§ØªÙ‡Ø§ ÙÙŠ Firebase
  const items = [
    { id: '1', name: "Ø¬Ø¨Ù†Ø© Ø´Ø±ÙƒØ³ÙŠØ©", image: "images/suger.jpg" },
    { id: '2', name: "Ø¬Ø¨Ù†Ø© Ø¨Ù„Ø¯ÙŠØ©", image: "images/sult.jpg" },
    { id: '3', name: "Ù„Ø¨Ù†Ø©", image: "images/egg.jpg" },
    // Ø£Ø¶Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‡Ù†Ø§ Ù…Ø¹ Ù…Ø¹Ø±ÙØ§ØªÙ‡Ø§ ÙÙŠ Firebase
  ];

  let cart = [];
  let filteredItems = [...items];

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  async function loadData() {
    try {
      const snapshot = await get(ref(database, 'products'));
      if (snapshot.exists()) {
        const data = snapshot.val();
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù† Firebase
        items.forEach(item => {
          const match = data[item.id];
          if (match) {
            item.name = match.name;
            item.image = match.image;
            item.value = match.value;
            item.quantity = match.quantity;
          }
        });
        renderProducts();
      } else {
        console.log("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª");
        renderProducts(); // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª
      }
    } catch (error) {
      console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ", error);
    }
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  function renderProducts() {
    const container = document.getElementById('productsContainer');
    container.innerHTML = '';
    filteredItems.forEach((item, index) => {
      const realIndex = items.indexOf(item);
      const div = document.createElement('div');
      div.className='product';
      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}" style="width:auto; height:98px; border-radius:8px; margin-bottom:15px; margin: 0 auto; display: block;">
        <h3>${item.name}</h3>
        <p class="price">Ø§Ù„Ø³Ø¹Ø±: ${item.value?.toLocaleString() ?? 'ØºÙŠØ± Ù…ØªÙˆÙØ±'} Ù„.Ø³</p>
        <div class="quantity-controls">
            <button onclick="decreaseQty(${realIndex})">-</button>
            <input type="text" id="qtyInput${realIndex}" value="1" readonly />
            <button onclick="increaseQty(${realIndex}, ${item.quantity ?? 0})">+</button>
        </div>
        <a href="#" class="btn" onclick="addToCart(event, ${realIndex})">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</a>
      `;
      container.appendChild(div);
    });
  }

  // Ø§Ù„Ø¨Ø­Ø«
  document.getElementById('searchInput').addEventListener('input', () => {
    const q = document.getElementById('searchInput').value.trim().toLowerCase();
    if (q === "") {
      filteredItems = [...items];
    } else {
      filteredItems = items.filter(i => i.name.toLowerCase().includes(q));
    }
    renderProducts();
  });

  // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ©
  window.increaseQty = function(index, max) {
    const input = document.getElementById(`qtyInput${index}`);
    let val = parseInt(input.value);
    if (val < max) {
      input.value = val + 1;
    } else {
      alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø´Ø±Ø§Ø¡ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©');
    }
  }

  // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©
  window.decreaseQty = function(index) {
    const input = document.getElementById(`qtyInput${index}`);
    let val = parseInt(input.value);
    if (val > 1) {
      input.value = val - 1;
    }
  }

  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
  window.addToCart = function(e, index) {
    e.preventDefault();
    const qty = parseInt(document.getElementById(`qtyInput${index}`).value);
    const item = items[index];
    const existingIndex = cart.findIndex(c => c.index === index);
    if (existingIndex !== -1) {
      if (cart[existingIndex].quantity + qty <= item.quantity) {
        cart[existingIndex].quantity += qty;
      } else {
        alert('Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© ØªØªØ¬Ø§ÙˆØ² Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©');
        return;
      }
    } else {
      cart.push({ index, name: item.name, value: item.value, quantity: qty, max: item.quantity });
    }
    updateCartCount();
    alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©');
  }

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©
  function updateCartCount() {
    const totalItems = cart.reduce((sum, c) => sum + c.quantity, 0);
    document.getElementById('cartCount').innerText = totalItems;
  }

  // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø©
 window.showCartPage = function() {
    document.getElementById('mainContent').style.display='none';
    document.getElementById('cartPage').style.display='block';
    renderCart();
    document.getElementById('orderForm').classList.remove('active');
 }

 // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
 window.showMain = function() {
    document.getElementById('mainContent').style.display='block';
    document.getElementById('cartPage').style.display='none';
    document.getElementById('orderForm').classList.remove('active');
 }

 // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ù„Ø©
 function renderCart() {
    const container = document.getElementById('cartItems');
    container.innerHTML = '';
    let total = 0;
    cart.forEach((item, index) => {
      total += item.value * item.quantity;
      const li = document.createElement('li');
      li.innerHTML = `
        <strong>${item.name}</strong><br/>
        Ø§Ù„Ø³Ø¹Ø±: ${item.value.toLocaleString()} Ù„.Ø³<br/>
        Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity} <br/>
        <button onclick="removeFromCart(${index})" style="margin-top:5px; padding:5px 10px; background-color:#e60000; color:#fff; border:none; border-radius:4px; cursor:pointer;">Ø­Ø°Ù</button>
      `;
      container.appendChild(li);
    });
    document.getElementById('totalPrice').innerText = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${total.toLocaleString()} Ù„.Ø³`;
 }

 function removeFromCart(i) {
    cart.splice(i,1);
    renderCart();
    updateCartCount();
 }

 // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
 document.getElementById('confirmOrderBtn').addEventListener('click', () => {
    if (cart.length === 0) {
      alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');
      return;
    }
    document.getElementById('orderForm').classList.add('active');
    document.getElementById('cartPage').style.display='none';
 });

 // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
 document.querySelector('#confirmOrderBtn').addEventListener('click', () => {
    const address = document.getElementById('deliveryAddress').value.trim();
    const phone = document.getElementById('phoneNumber').value.trim();
    if (!address || !phone) {
      alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ');
      return;
    }
    let message = 'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯:\n';
    let total = 0;
    cart.forEach(item => {
      total += item.value * item.quantity;
      message += `${item.name} Ã— ${item.quantity}\n`;
    });
    message += `Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€\n`;
    message += `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${total.toLocaleString()} Ù„.Ø³\n`;
    message += `\nØ§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}\n`;
    message += `Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\n`;
    const encodedMessage = encodeURIComponent(message);
    const whatsappNumber = '+963936421060';
    const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
    window.open(whatsappURL, '_blank');
    document.getElementById('deliveryAddress').value = '';
    document.getElementById('phoneNumber').value = '';
    document.getElementById('orderForm').classList.remove('active');
    showMain();
 });

 // ÙˆØ¸ÙŠÙØ© ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± ØªØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø²ÙˆÙ„ Ù„Ø£Ø³ÙÙ„
 const adminBtn = document.getElementById('adminFixedBtn');
 window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
      adminBtn.style.display = 'block';
    } else {
      adminBtn.style.display = 'none';
    }
 });

 function promptAdmin() {
    const pw = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¯ÙŠØ±:');
    if (pw === 'admin123') {
      document.getElementById('adminPanel').style.display='block';
      renderAdminProducts();
    } else {
      alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
    }
 }

 function renderAdminProducts() {
    const container = document.getElementById('adminProducts');
    container.innerHTML = '';
    items.forEach((item, i) => {
      container.innerHTML += `
      <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px; border-radius:5px;">
        <input style="width:100%; margin-bottom:5px;" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" onchange="items[${i}].name=this.value" value="${item.name}"/>
        <input style="width:100%; margin-bottom:5px;" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" onchange="items[${i}].value=Number(this.value)" value="${item.value}"/>
        <input style="width:100%; margin-bottom:5px;" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" onchange="items[${i}].quantity=Number(this.value)" value="${item.quantity}"/>
        <button onclick="deleteItem(${i})" style="background:#e60000; color:#fff; border:none; padding:5px 8px; border-radius:4px; cursor:pointer;">Ø­Ø°Ù</button>
      </div>
      `;
    });
 }

 function addProduct() {
    items.push({name:'Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©', value:1000, quantity:100});
    renderAdminProducts();
    renderProducts();
 }

 function deleteItem(i) {
    items.splice(i,1);
    renderAdminProducts();
    renderProducts();
 }

 function closeAdmin() {
    document.getElementById('adminPanel').style.display='none';
 }

 // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
 loadData();

</script>
</body>
</html>
