<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>السوق الإلكتروني</title>
<!-- إضافة خط من Google Fonts يدعم العربية -->
<link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet" />
<link rel="icon" href="images/icon.jpg">
<style>
  /* التنسيقات الأساسية */
  * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
  }
  body {
      font-family: 'Cairo', Arial, Tahoma, sans-serif;
      background-color: #f8f9fa;
      color: #333;
      line-height: 1.6;
      margin-top: 60px;
      position: relative;
  }
  header {
      position: fixed; 
      width: 100%;
      background-color: #007bff;
      color: #fff;
      padding: 10px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 14px;
      top: 0px;
      z-index: 999;
  }
  header h1 {
      font-size: 1.2em;
  }
  /* زر المدير */
#adminFixedBtn {
    display: none;
    position: fixed;
    bottom: 0;
    right: 7px;
    width: 15px;
    height: 8px;
    padding: 6px 10px;
    background-color: transparent;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-family: 'Cairo', Arial, Tahoma, sans-serif;
    font-size: 4px;
    cursor: pointer;
    color: #555;
    transition: background-color 0.3s, color 0.3s;
}
#adminFixedBtn:hover {
    background-color: #eee;
    color: #000;
}
/* زر السلة */
#cartFloatingButton {
    position: fixed;
    bottom: 22px;
    left: 15px;
    background-color: #0f7b5a;
    color: #fff;
    padding: 12px 20px;
    border-radius: 50px;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    font-size: 16px;
    display: flex;
    align-items: center;
    transition: background-color 0.3s;
}
#cartFloatingButton:hover {
    background-color: #388E3C;
}
/* لوحة إدارة المنتجات للمدير */
#adminPanel {
    display: none; 
    position: fixed; 
    top: 50px; 
    right: 50px; 
    background: #fff; 
    padding: 20px; 
    border-radius: 8px; 
    max-height: 80%; 
    overflow: auto; 
    z-index: 9999; 
    width: 90%; 
    max-width: 900px;
}
/* أزرار +/- */
.quantity-controls button {
    padding: 5px 10px;
    font-size: 1em;
    border: none;
    background-color: #007bff;
    color: #fff;
    border-radius: 4px;
    cursor: pointer;
    margin: 0 5px;
    transition: background-color 0.3s;
}
.quantity-controls button:hover {
    background-color: #0056b3;
}
/* مربع الكمية */
#qtyInput {
    width: 40px;
    height: 30px;
    text-align: center;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin: 0 5px;
    font-size: 1em;
}
/* التنسيقات العامة */
* {
    box-sizing: border-box;
}
body {
    font-family: 'Cairo', Arial, Tahoma, sans-serif;
    background-color: #f8f9fa;
    color: #333;
    line-height: 1.6;
}
header {
    background-color: #007bff;
    color: #fff;
    padding: 10px 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 14px;
}
header h1 {
    font-size: 1.2em;
}
#searchInput {
    display: flex;
    position: fixed; 
    top: 52px;
    left: 30px;
    margin-bottom: 15px;
    width: 90%;
    max-width: 300px;
    padding: 13px 17px;
    font-size: 16px;
    border-radius: 25px;
    border: 2px solid #007bff;
    outline: none;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}
#searchInput:focus {
    border-color: #0056b3;
    box-shadow: 0 6px 12px rgba(0,0,0,0.2);
}
.products {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    margin-top: 100px;
}
.product {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 300px;
    padding: 15px;
    transition: transform 0.2s;
    text-align: center;
}
.product:hover {
    transform: scale(1.02);
}
.product h3 {
    margin-bottom: 10px;
    font-size: 1.2em;
}
.price {
    color: #e60000;
    font-weight: bold;
    margin-bottom: 10px;
}
.quantity-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 10px;
}
.btn {
    display: inline-block;
    padding: 10px 15px;
    background-color: #007bff;
    color: #fff;
    border-radius: 5px;
    text-decoration: none;
    transition: background-color 0.3s;
    margin-top: 10px;
}
.btn:hover {
    background-color: #0056b3;
}
footer {
    background-color: #343a40;
    color: #fff;
    padding: 20px;
    text-align: center;
    margin-top: 40px;
}
#cartContainer {
    margin-top: 40px;
}
#cartItems {
    list-style: none;
    padding: 0;
    max-width: 600px;
    margin: auto;
}
#cartItems li {
    padding: 10px;
    border-bottom: 1px solid #ccc;
    margin-bottom: 10px;
    background-color: #fff;
    border-radius: 8px;
}
#totalPrice {
    text-align: right;
    font-weight: bold;
    margin-top: 15px;
    font-size: 1.2em;
}
#cartPage {
    display: none;
    padding: 20px;
}
#cartPage.active {
    display: block;
}
#orderForm {
    display: none;
    margin-top: 20px;
}
#orderForm.active {
    display: block;
}
</style>
</head>
<body>
<header>
    <h1>السوق الإلكتروني</h1>
</header>

<!-- زر المدير يظهر عند النزول لأسفل -->
<button id="adminFixedBtn" onclick="promptAdmin()">وضع المدير</button>

<!-- زر السلة عائم -->
<button id="cartFloatingButton" onclick="showCartPage()">
    🛒 السلة <span id="cartCount">0</span>
</button>

<!-- المحتوى الرئيسي -->
<div id="mainContent" class="container">
    <h2 style="text-align:center; margin-bottom: 14px; margin-top: 8px;">منتجاتنا</h2>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="🔍 ابحث عن منتج..." />
        <!-- تم حذف زر تحديث البيانات -->
    </div>
    <div class="products" id="productsContainer"></div>
</div>

<!-- صفحة السلة -->
<div id="cartPage">
    <h2 style="text-align:center;">السلة</h2>
    <ul id="cartItems"></ul>
    <div id="totalPrice">المجموع النهائي: 0 ل.س</div>
    <button onclick="showMain()" style="margin-top:15px; padding:10px 20px; background-color:#007bff; color:#fff; border:none; border-radius:4px; cursor:pointer;">العودة للمنتجات</button>
    <button id="confirmOrderBtn" style="margin-top:15px; padding:10px 20px; background-color:#28a745; color:#fff; border:none; border-radius:4px; cursor:pointer;">تأكيد الطلب</button>
</div>

<!-- حقل التوصيل -->
<div id="orderForm">
    <h3>املأ بيانات التوصيل</h3>
    <label>العنوان:</label>
    <input type="text" id="deliveryAddress" placeholder="أدخل عنوانك" />
    <label>رقم الهاتف:</label>
    <input type="text" id="phoneNumber" placeholder="أدخل رقم هاتفك" />
</div>

<!-- لوحة إدارة المنتجات للمدير -->
<div id="adminPanel" style="display:none;">
    <h3>إدارة المنتجات</h3>
    <div id="adminProducts"></div>
    <button onclick="addProduct()">إضافة مادة جديدة</button>
    <button onclick="closeAdmin()">إغلاق</button>
</div>

<!-- حقوق النشر -->
<footer>
    <p>© 2025 السوق الإلكتروني. جميع الحقوق محفوظة.</p>
</footer>

<script>
const items = [
  { id: 1, name: "سكر فرط", image: "images/suger.jpg" },
  { id: 2, name: "ملح", image: "images/sult.jpg" },
  { id: 3, name: "بيض", image: "images/egg.jpg" }
  // يمكن إضافة المزيد من المنتجات هنا
];

let cart = [];
let filteredItems = [...items];

async function loadData() {
  try {
    const res = await fetch('data.json');
    const externalData = await res.json();
    // دمج البيانات من ملف json مع المنتجات الموجودة
    items.forEach(product => {
      const data = externalData.find(d => d.id === product.id || d.name === product.name);
      if (data) {
        product.value = data.value;
        product.quantity = data.quantity;
      } else {
        // إذا لم توجد بيانات، يمكن إعطاء قيم افتراضية
        if (product.value === undefined) product.value = 100;
        if (product.quantity === undefined) product.quantity = 0;
      }
    });
    renderProducts();
  } catch (e) {
    console.error("فشل تحميل البيانات:", e);
    // في حال فشل التحميل، استمر باستخدام القيم الحالية
    renderProducts();
  }
}

window.onload = () => {
  loadData();
}

function renderProducts() {
  const container = document.getElementById('productsContainer');
  container.innerHTML = '';
  filteredItems.forEach((item, index) => {
    const realIndex = items.indexOf(item);
    const div = document.createElement('div');
    div.className='product';
    div.innerHTML = `
      <img src="${item.image}" alt="${item.name}" style="width:auto; height:98px; border-radius:8px; margin-bottom:15px; margin: 0 auto; display: block;">
      <h3>${item.name}</h3>
      <p class="price">السعر: ${item.value.toLocaleString()} ل.س</p>
      <div class="quantity-controls">
        <button onclick="decreaseQty(${realIndex})">-</button>
        <input type="text" id="qtyInput${realIndex}" value="1" readonly />
        <button onclick="increaseQty(${realIndex}, ${item.quantity})">+</button>
      </div>
      <a href="#" class="btn" onclick="addToCart(event, ${realIndex})">إضافة إلى السلة</a>
    `;
    container.appendChild(div);
  });
}

document.getElementById('searchInput').addEventListener('input', () => {
  const q = document.getElementById('searchInput').value.trim().toLowerCase();
  if (q === "") {
    filteredItems = [...items];
  } else {
    filteredItems = items.filter(i => i.name.toLowerCase().includes(q));
  }
  renderProducts();
});

function increaseQty(index, max) {
  const input = document.getElementById(`qtyInput${index}`);
  let val = parseInt(input.value);
  if (val < max) {
    input.value = val + 1;
  } else {
    alert('لا يمكن شراء أكثر من الكمية المتوفرة');
  }
}

function decreaseQty(index) {
  const input = document.getElementById(`qtyInput${index}`);
  let val = parseInt(input.value);
  if (val > 1) {
    input.value = val - 1;
  }
}

function addToCart(e, index) {
  e.preventDefault();
  const qty = parseInt(document.getElementById(`qtyInput${index}`).value);
  const item = items[index];
  const existingIndex = cart.findIndex(c => c.index === index);
  if (existingIndex !== -1) {
    if (cart[existingIndex].quantity + qty <= item.quantity) {
      cart[existingIndex].quantity += qty;
    } else {
      alert('الكمية الإجمالية تتجاوز الكمية المتوفرة');
      return;
    }
  } else {
    cart.push({ index, name: item.name, value: item.value, quantity: qty, max: item.quantity });
  }
  updateCartCount();
  alert('تمت إضافة المنتج إلى السلة');
}

function updateCartCount() {
  const totalItems = cart.reduce((sum, c) => sum + c.quantity, 0);
  document.getElementById('cartCount').innerText = totalItems;
}

function showCartPage() {
  document.getElementById('mainContent').style.display='none';
  document.getElementById('cartPage').style.display='block';
  renderCart();
  document.getElementById('orderForm').classList.remove('active');
}

function showMain() {
  document.getElementById('mainContent').style.display='block';
  document.getElementById('cartPage').style.display='none';
  document.getElementById('orderForm').classList.remove('active');
}

function renderCart() {
  const container = document.getElementById('cartItems');
  container.innerHTML = '';
  let total = 0;
  cart.forEach((item, index) => {
    total += item.value * item.quantity;
    const li = document.createElement('li');
    li.innerHTML = `
      <strong>${item.name}</strong><br/>
      السعر: ${item.value.toLocaleString()} ل.س<br/>
      الكمية: ${item.quantity} <br/>
      <button onclick="removeFromCart(${index})" style="margin-top:5px; padding:5px 10px; background-color:#e60000; color:#fff; border:none; border-radius:4px; cursor:pointer;">حذف</button>
    `;
    container.appendChild(li);
  });
  document.getElementById('totalPrice').innerText = `المجموع النهائي: ${total.toLocaleString()} ل.س`;
}

function removeFromCart(i) {
  cart.splice(i,1);
  renderCart();
  updateCartCount();
}

document.getElementById('confirmOrderBtn').addEventListener('click', () => {
  if (cart.length === 0) {
      alert('السلة فارغة');
      return;
  }
  document.getElementById('orderForm').classList.add('active');
  document.getElementById('cartPage').style.display='none';
});

document.querySelector('#confirmOrderBtn').addEventListener('click', () => {
  const address = document.getElementById('deliveryAddress').value.trim();
  const phone = document.getElementById('phoneNumber').value.trim();
  if (!address || !phone) {
      alert('يرجى ملء العنوان ورقم الهاتف');
      return;
  }
  let message = 'طلب جديد:\n';
  let total = 0;
  cart.forEach(item => {
      total += item.value * item.quantity;
      message += `${item.name} × ${item.quantity}\n`;
  });
  message += `ـــــــــــــــــــــــــــــــــــــ\n`;
  message += `المجموع النهائي: ${total.toLocaleString()} ل.س\n`;
  message += `\nالعنوان: ${address}\n`;
  message += `رقم الهاتف: ${phone}\n`;
  const encodedMessage = encodeURIComponent(message);
  const whatsappNumber = '+963936421060';
  const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
  window.open(whatsappURL, '_blank');
  document.getElementById('deliveryAddress').value = '';
  document.getElementById('phoneNumber').value = '';
  document.getElementById('orderForm').classList.remove('active');
  showMain();
});

// زر وضع المدير عند النزول لأسفل
const adminBtn = document.getElementById('adminFixedBtn');
window.addEventListener('scroll', () => {
  if (window.scrollY > 300) {
      adminBtn.style.display = 'block';
  } else {
      adminBtn.style.display = 'none';
  }
});

function promptAdmin() {
  const pw = prompt('أدخل كلمة سر المدير:');
  if (pw === 'admin123') {
      document.getElementById('adminPanel').style.display='block';
      renderAdminProducts();
  } else {
      alert('كلمة السر غير صحيحة');
  }
}

function renderAdminProducts() {
  const container = document.getElementById('adminProducts');
  container.innerHTML = '';
  items.forEach((item, i) => {
      container.innerHTML += `
      <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px; border-radius:5px;">
          <input style="width:100%; margin-bottom:5px;" placeholder="اسم المنتج" onchange="items[${i}].name=this.value" value="${item.name}"/>
          <input style="width:100%; margin-bottom:5px;" type="number" placeholder="السعر" onchange="items[${i}].value=Number(this.value)" value="${item.value}"/>
          <input style="width:100%; margin-bottom:5px;" type="number" placeholder="الكمية" onchange="items[${i}].quantity=Number(this.value)" value="${item.quantity}"/>
          <button onclick="deleteItem(${i})" style="background:#e60000; color:#fff; border:none; padding:5px 8px; border-radius:4px; cursor:pointer;">حذف</button>
      </div>
      `;
  });
}

function addProduct() {
  items.push({name:'مادة جديدة', value:100, quantity:100});
  renderAdminProducts();
  renderProducts();
}

function deleteItem(i) {
  items.splice(i,1);
  renderAdminProducts();
  renderProducts();
}

function closeAdmin() {
  document.getElementById('adminPanel').style.display='none';
}
</script>
</body>
</html>
